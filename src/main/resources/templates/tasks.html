<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymleaf.org">
<head>
  <link rel="stylesheet" th:href="@{/css/style.build.tailwind.css}">
  <meta charset="UTF-8">
  <title>MarkIt</title>
  <style>
    :root {
      /* Light theme  */
      --bg-start: #62a0f6;
      --bg-end: #4b42c3;
      --card-bg: #ffffff;
      --text-color: #6366f2;
      --input-bg: #f9fafb;
      --input-border: #d1d5db;
      --toggle-bg: #10b981;
      --delete-bg: #ef4444;
      --button-bg: #4f46e5;
    }
  </style>
</head>
<body style="background: linear-gradient(to right, var(--bg-start), var(--bg-end)); color: var(--text-color);" class="min-h-screen flex items-center justify-center font-sans px-2 sm:px-4">
<div style="background-color: var(--card-bg);" class="shadow-2xl rounded-2xl p-6 sm:p-8 w-full max-w-lg sm:max-w-md lg:max-w-xl transition-colors duration-300">

  <!-- Header with Toggle -->
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-center w-full absolute left-0 right-0">MarkIt</h1>
    <button
            id="theme-toggle"
            class="px-3 py-2 rounded-lg shadow hover:opacity-80 transition"
            style="background-color: var(--input-bg); color: var(--text-color);"
    ></button>
  </div>

  <form action="/" method="post" class="flex flex-col gap-3 mb-6">
    <input
            type="text"
            name="title"
            placeholder="Task title..."
            required
            class="rounded-xl px-4 py-3 focus:outline-none focus:ring-2 shadow-sm"
            style="background-color: var(--input-bg); border: 1px solid var(--input-border); color: var(--text-color);"
    >
    <input
            type="text"
            name="description"
            placeholder="Description (optional)"
            class="rounded-xl px-4 py-3 focus:outline-none focus:ring-2 shadow-sm"
            style="background-color: var(--input-bg); border: 1px solid var(--input-border); color: var(--text-color);"
    >
    <select
            name="priority"
            class="rounded-xl px-4 py-3 focus:outline-none focus:ring-2 shadow-sm"
            style="background-color: var(--input-bg); border: 1px solid var(--input-border); color: var(--text-color);"
    >
      <option value="Low">Low</option>
      <option value="Medium">Medium</option>
      <option value="High">High</option>
    </select>
    <input
            type="date"
            name="dueDate"
            class="rounded-xl px-4 py-3 focus:outline-none focus:ring-2 shadow-sm"
            style="background-color: var(--input-bg); border: 1px solid var(--input-border); color: var(--text-color);"
    >

    <button
            type="submit"
            class="font-semibold px-6 py-3 rounded-xl shadow-md hover:opacity-80 transition text-lg w-full sm:w-auto"
            style="background-color: var(--button-bg); color: white;"
    >
      Add
    </button>
  </form>

  <!-- Tasks List -->
  <div class="space-y-3">
    <th:block th:each="task : ${tasks}">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between px-4 py-3 rounded-xl shadow-sm hover:opacity-90 transition"
           style="background-color: var(--input-bg); color: var(--text-color); border: 1px solid var(--input-border);">

        <div class="flex-1 mb-3 sm:mb-0">
          <span th:classappend="${task.completed} ? 'line-through text-gray-400' : ''"
                th:text="${task.title}" class="font-medium truncate block">Task Title</span>
          <span th:text="${task.description}" class="block text-sm text-gray-500 truncate">Description</span>
          <span th:text="'Priority: ' + ${task.priority}" class="block text-sm text-gray-500">Priority</span>
          <span th:text="'Due: ' + ${task.dueDate}" class="block text-sm text-gray-500">Due Date</span>
          <span th:text="'Created: ' + ${task.createdAt}" class="block text-xs text-gray-400">Created Date</span>
        </div>

        <div class="flex gap-2 w-full sm:w-auto">
          <a th:href="@{/{id}/toggle(id=${task.id})}"
             th:text="${task.completed} ? 'Undo' : 'Mark as Done'"
             class="flex-1 sm:flex-none px-4 py-2 text-sm rounded-lg font-semibold shadow hover:opacity-80 transition text-center"
             style="background-color: var(--toggle-bg); color: white;">
          </a>
          <a th:href="@{/{id}/delete(id=${task.id})}"
             class="flex-1 sm:flex-none px-4 py-2 text-sm rounded-lg font-semibold shadow hover:opacity-80 transition text-center"
             style="background-color: var(--delete-bg); color: white;">
            Delete
          </a>
        </div>
      </div>
    </th:block>
  </div>
</div>

<script>
  const btn = document.getElementById('theme-toggle');

  const lightVars = {
    '--bg-start': '#62a0f6',
    '--bg-end': '#4b42c3',
    '--card-bg': '#ffffff',
    '--text-color': '#374151',
    '--input-bg': '#f9fafb',
    '--input-border': '#d1d5db',
    '--toggle-bg': '#10b981',
    '--delete-bg': '#ef4444',
    '--button-bg': '#4f46e5',
  };

  const darkVars = {
    '--bg-start': '#111827',
    '--bg-end': '#000000',
    '--card-bg': '#1f2937',
    '--text-color': '#e5e7eb',
    '--input-bg': '#374151',
    '--input-border': '#4b5563',
    '--toggle-bg': '#22c55e',
    '--delete-bg': '#ef4444',
    '--button-bg': '#6366f1',
  };

  // Apply theme based on localStorage
  if(localStorage.theme === 'light') {
    applyTheme(lightVars);
    btn.textContent = 'üåô';
  } else {
    applyTheme(darkVars);
    btn.textContent = '‚òÄÔ∏è';
  }

  function applyTheme(vars) {
    for (const key in vars) {
      document.documentElement.style.setProperty(key, vars[key]);
    }
  }

  btn.addEventListener('click', () => {
    if (localStorage.theme === 'dark') {
      applyTheme(lightVars);
      localStorage.theme = 'light';
      btn.textContent = 'üåô';
    } else {
      applyTheme(darkVars);
      localStorage.theme = 'dark';
      btn.textContent = '‚òÄÔ∏è';
    }
  });
</script>
</body>
</html>
